<?php
header('Content-Type: application/json');
include("classZebra.php");
$resposta = [];

if($_SERVER["REQUEST_METHOD"] == "POST"){
$isrequired = false;
$quantidade = 1;

if(empty($_POST["nome"])){
	$resposta["nome"] = false;
	$isrequired = true;
}
 if(empty($_POST["cargo"])){
	 $resposta["cargo"] = false;
	 $isrequired = true;
}
 if(empty($_POST["periodo"])){
	$resposta["periodo"] = false;
	$isrequired = true;
}
 if(empty($_POST["qrcode"])){
	$resposta["qrcode"] = false;
	$isrequired = true;
}
 if(empty($_POST["quantidade"])){
	$resposta["quantidade"] = 1;
}else{
	$quantidade = $_POST["quantidade"];

}

if($isrequired){
	$resposta["message"] =  "not working";
	http_response_code (400);
	$resposta["code"] = 400;
}else{
$nome =  $_POST["nome"];
$cargo =  $_POST["cargo"];
$periodo =  $_POST["periodo"];
$infoBarCode = $_POST["qrcode"];
$ORIENTATION = "Y"; //N
$name =  "localhost\zebra";

$lines = "^XA
	^CI28
	^LH0,0 ^FWN,0 ^PO".$ORIENTATION." ^CF0 ^LRY ^MMT ^PW424 ^LL863
	^FT50,660^A0B,27,28^FH^FDCRUZEIRO ESPORTE CLUBE^FS
	^FT70,660^A0B,20,20^FH^FDCLUBE DE LAZER^FS
	^FT110,660^A0B,22,22^FH^FD" . $nome . "^FS
	^FT132,660^A0B,22,22^FH^FD" . $cargo . "^FS
	^FT215,650^A0B,80,100^FH^FDCONVITE^FS
	^FT255,650^A0B,40,40^FH^FDINDIVIDUAL^FS
	^FT255,390^A0B,25,24^FH^FDVENDA PROIBIDA^FS
	^FO268,210^GB2,448,2^FS
	^FT300,650^A0B,25,25^FH^FDVÁLIDO POR 1 DIA ENTRE^FS
	^FT340,655^A0B,44,44^FH^FD" . $periodo . "^FS
	^FT375,660^A0B,21,20^FH^FDFavor identificar-se na portaria do clube.^FS
	^FT180,60^A0N,17,17^FH^FDCRUZEIRO ESPORTE CLUBE^FS
	^FT180,75^A0N,15,15^FH^FDCLUBE DE LAZER^FS
	^FT180,90^A0N,15,15^FH^FDCONVITE INDIVIDUAL^FS
	^FT180,105^A0N,17,17^FH^FD" . $periodo . "^FS
	^FT180,125^A0N,20,20^FH^FD" . $nome . "^FS
	^FT180,140^A0N,20,20^FH^FD" . $cargo . "^FS
	^FT40,160 ^BQN,2,4 ^FDMM,B0032". $infoBarCode . "^FS
	^FT150,840 ^BQN,2,4 ^FDMM,B0032". $infoBarCode . "^FS
	^FO145,206^GB45,455,210^FS
	^FO0,-718^GFA,1600,1600,16, 
	,:::U0G1GFH0GFGCQ0T0G1GCJ0G1G8P0T0GCL0G1G8O0S0G2H0G3GFJ0G6O0S0G8H0G3GFG8G3GFH0G8N0R0G2J0G3G8G7G3G8G0G2N0R0G8J0G7G8G6G1G8G0G1G8M0Q0G3J0G3GFG8H3G8H0G4M0Q0G4K0G3G8G7GFG0G3GCG1M0Q0G8K0G3G8G6G3G0G7GEG0G8L0P0G3G0GFG8H0G3GFG8H7G0GEG3G0G4L0P0G4G1GFGCH0G1GCG0G3GFG0GCG3G0G2L0P0G8G3G0GCL0G6G1GCG3H0G8K0O0G1G0G3G0GCM0G1G8G6H0G4K0O0G2G0G3G0G6H0G1HFGCG0G1G8GEG0GCG2K0O0G4G0G3G8GCG0G1JFGCH0GCG0G6L0O0G8G0G1HCG0LFG8G1GCG0G3G1K0Q0G1GFG8G3LFGEI0G3H8J0N0H1GEG0G6G0NFG8H0G3G8G4J0N0G2G3GEH0G3NFGEH0G7G0G2J0N0G4G6G7H0G7OFH0GEG0G2J0N0G4G6G7GEG1PFG8G1GCG0G1J0N0G8GEG6GEG3PFGCG3G8H0G8I0O0G7GCG0G7IFGBMFG1G0G1H8I0M0G1G0G3GCG0JFG9MFH0G1GCG4I0O0G1GEG1JFG8G1LFG8G1G0G6G4I0M0G2H0GEG1JFG0G1LFGCG1G8H2I0P0G2G3IFGCG0G3LFGEG1G8H2I0M0G4G7H0G7IFGCG0G3MFG1G8G6G1I0N0G7GCG0KFG0G1MFG1G8GEG1I0M0G8G1GFG0KFG8G1MFG8GFGCJ0M0G8G0G7G9KFG9NFG8G7H0G8H0O0H1KFGBNFGCI0G8H0L0G1I0G3TFGCL0L0G1G3H0G3TFGEI0G4H0L0G1G3G2G0G3TFGEI0G4H0M0G3G6G4G7UFI0G4H0L0H2G6G4G7UFL0L0G2G6G4GCG7MFG3MFI0G2H0L0G2G7GEGCNFG0G7LFI0G2H0L0G2G7GFGCMFGCG0MFG8H0G2H0N0GFG8MFGCG0JFGBHFG8G9G3G2H0P0HFG3JFGEG0JFG9GDGFG8G9GBG2H0P0HFG1G9JFG2G7IFG8G1GFG8G9GBI0P0HFG0G1JFG7JFG0G3GFG8G9GBI0P0GFGEG0G3NFG8G0G3GFG8HFI0M0G4G1G8GFG8G0G7NFGCG0G3GFG8HFI0M0G7G1G8GFGCG0G3OFG0G1GFG8GFGEI0M0G7G9G8HFG0G1OFG8G1GFG8K0M0G7GFG8HFH1OFG9HFG8K0M0G6GFG8HFG3PFGBHFG8H0G2H0M0G6G3G8HFGBSFH8G0G2H0M0G6G1G8VFG9G8G0G2H0L0G2I0VFG9G8G0G2H0L0G2I0VFG1GFG8G2H0L0G2I0G7UFG1GFGEI0P0G7UFG3G0G6I0N0G3GEG7TFGEG3H0G4H0L0H1GFGEG3TFGEI0G4H0L0G1G3GCH3TFGEI0G4H0M0G1G0G3G1KFGBNFGCI0G8H0M0G8G0G3G1KFG9GDMFGCG7H0G8H0M0G8G0GFG0KFG8G1MFG8GFG8G0G8H0N0G7GEG0KFG0G3MFG8G9GFG1I0M0G4GFG8G0G7IFG8G0G3MFG1G9GFG9I0M0H4H0G3IFGCG0G3LFGEG3H9J0M0G2H0G6G3JFG0G1LFGEG3GFG0G2I0M0G2H0GEG1JFG8G1LFGCG1GFK0M0G1H0GCG0JFG9MFG8G0G7G8G4I0M0G1G0G7GCG0G7IFGBMFH0G1GCJ0N0G8G7GCG4G3PFGEJ0G8I0O0G6G7GEG1PFGCG7GCG0G1J0N0G4G6G3GCG0PFG8GFGEG0G1J0N0G2G3G7G8G0G3NFGEG0GCG7G0G2J0O0G1GEH0G1NFGCG1G8G3G0G4J0N0H1GCG0GFG8G7MFH0GCG3L0O0G8H0GFGCG1LFGCH0GCG3G0G8J0O0G4I0GCG0G7JFGEG0G2G0GFG7G1K0O0G2I0G6H0G7IFH0GFG8G7GEG2K0O0G1G0G3G0GEM0G3G9G8G0G8G4K0P0G8G3G0GCM0G3G1G8H0G8K0P0G4G3G9GCK0G3GCG3G9G8G0G1L0P0G2G1GFG8H0G3GFG8G6GEG1GFH0G2L0P0G1G0G6I0G3GBG8GEG0G1GEH0GCL0Q0GCJ0G3H0GFG8G0GCG0G1M0Q0G2J0G3GEG0G7GFG0GEG0G2M0Q0G1G8I0G3GFH0G7G0G6G0G8M0R0G4I0G3I0G3H0G3N0R0G1I0G3H0G7GEH0GCN0S0G6H0G7GFG0G3GCG0G3O0S0G1G8M0GCO0T0G3L0GEP0U0G3G8I0GEQ0V0G1HFG8R0,:
	^FS
	^XZ";

	$hostPrinter =  sprintf("\\%s", $name);

	$speedPrinter = 4;
	$darknessPrint = 20;
	$labelSize = array(300,10);
	$referencePoint = array(223,15);


try
{
	for ($i = 1; $i <= $quantidade; $i++) {
		$z = new ZebraPrinter($hostPrinter, $speedPrinter, $darknessPrint, $labelSize, $referencePoint);
		$z->setCard($lines);
		$z->setLabelCopies(1);
		$z->print2zebra();
	}
	$resposta["message"] =  "work";
	http_response_code (200);
	$resposta["code"] = 200;
}
catch (Exception $e)
{
	$resposta["code"] = 204;
	http_response_code (204);
	$resposta["error"] =   $e->getMessage();
	echo 'Caught exception: ',  $e->getMessage(), "\n";
}
}
echo json_encode($resposta);
}else if($_SERVER["REQUEST_METHOD"] == "GET"){
	echo "<h1>GET NOT FOUND</h1>";
	http_response_code (405);

}else{
	echo "<h1>NOT FOUND</h1>";
	http_response_code (404);
}
